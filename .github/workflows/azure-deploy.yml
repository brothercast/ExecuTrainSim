name: Deploy Node.js App to Azure  

on:  
  push:  
    branches:  
      - main  

jobs:  
  build-and-deploy:  
    runs-on: ubuntu-latest  
    steps:  
    - name: Checkout code  
      uses: actions/checkout@v2  

    - name: Set up Node.js  
      uses: actions/setup-node@v2  
      with:  
        node-version: '18.x'  

    - name: Install and Build  
      run: |  
        cd executrainsim  
        npm install  
        npm run build  
        cd ../execuTrainServer  
        npm install  

    - name: Upload artifacts  
      uses: actions/upload-artifact@v2  
      with:  
        name: node-app  
        path: ./executrainsim/build  

    - name: Deploy to Azure Web App  
      uses: azure/webapps-deploy@v2  
      with:  
        app-name: 'ExecuTrainSim'  
        package: ./executrainsim/build  
        slot-name: 'production'  