name: Build and deploy Node.js app to Azure Web App - ExecuTrainSim  
  
on:  
  push:  
    branches:  
      - main  
  workflow_dispatch:  
  
env:  
  AZURE_RESOURCE_GROUP: 'ExecuTrainSimGroup'  
  FRONTEND_WEBAPP_NAME: 'ExecuTrainSim-Frontend'  
  BACKEND_WEBAPP_NAME: 'ExecuTrainSim-Backend'  
  
jobs:  
  build:  
    runs-on: ubuntu-latest  
    steps:  
      - name: Checkout code  
        uses: actions/checkout@v4  
  
      - name: Set up Node.js  
        uses: actions/setup-node@v3  
        with:  
          node-version: '20.x'  
          cache: 'npm'  
  
      - name: Build frontend  
        working-directory: ./executrainsim  
        run: |  
          npm install  
          npm run build  
  
      - name: Build backend  
        working-directory: ./execuTrainServer  
        run: |  
          npm install  
          npm run build  
  
      - name: Upload frontend artifact  
        uses: actions/upload-artifact@v4  
        with:  
          name: frontend-app  
          path: executrainsim/build  
          retention-days: 1  
  
      - name: Upload backend artifact  
        uses: actions/upload-artifact@v4  
        with:  
          name: backend-app  
          path: execuTrainServer/dist  
          retention-days: 1  
  
  deploy-frontend:  
    runs-on: ubuntu-latest  
    needs: build  
    steps:  
      - name: Download frontend artifact  
        uses: actions/download-artifact@v4  
        with:  
          name: frontend-app  
  
      - name: Login to Azure  
        uses: azure/login@v2  
        with:  
          creds: ${{ secrets.AZURE_CREDENTIALS }}  
  
      - name: Deploy frontend to Azure Web App  
        uses: azure/webapps-deploy@v3  
        with:  
          app-name: ${{ env.FRONTEND_WEBAPP_NAME }}  
          package: ./executrainsim/build  
  
  deploy-backend:  
    runs-on: ubuntu-latest  
    needs: build  
    steps:  
      - name: Download backend artifact  
        uses: actions/download-artifact@v4  
        with:  
          name: backend-app  
  
      - name: Login to Azure  
        uses: azure/login@v2  
        with:  
          creds: ${{ secrets.AZURE_CREDENTIALS }}  
  
      - name: Deploy backend to Azure Web App  
        uses: azure/webapps-deploy@v3  
        with:  
          app-name: ${{ env.BACKEND_WEBAPP_NAME }}  
          package: ./execuTrainServer/dist  